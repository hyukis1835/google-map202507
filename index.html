<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>Googleマップ with CSV</title>
  <style>
    html, body, #map {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    .infowindow-content {
      font-size: 14px;
      font-weight: bold;
      padding: 4px 6px;
    }

    /* ❌ボタンを非表示 */
    .gm-ui-hover-effect {
      display: none !important;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    let map;
    let openInfoWindow = null;

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 35.6895, lng: 139.6917 }, // 東京
        zoom: 3,
        gestureHandling: 'cooperative',
        scrollwheel: true
      });

      // CSVをバイナリで取得してUTF-8でデコード
      fetch("places.csv")
        .then(response => response.arrayBuffer())
        .then(buffer => {
          const text = new TextDecoder("utf-8").decode(buffer);
          const lines = text.trim().split("\n");
          lines.forEach((line, index) => {
            const [name, lat, lng] = line.split(",");
            if (!name || !lat || !lng) return;

            const position = {
              lat: parseFloat(lat),
              lng: parseFloat(lng)
            };

            const marker = new google.maps.Marker({
              position,
              map,
              title: name,
              label: {
                text: (index + 1).toString(),
                color: "white",
                fontWeight: "bold",
                fontSize: "14px"
              },
              icon: {
                path: google.maps.SymbolPath.CIRCLE,
                scale: 10,
                fillColor: "#f60",
                fillOpacity: 1,
                strokeWeight: 2,
                strokeColor: "#fff"
              }
            });

            const infoWindow = new google.maps.InfoWindow({
              content: `<div class="infowindow-content">${name}</div>`
            });

            marker.addListener("click", () => {
              if (openInfoWindow) {
                openInfoWindow.close();
                if (openInfoWindow === infoWindow) {
                  openInfoWindow = null;
                  return;
                }
              }
              infoWindow.open(map, marker);
              openInfoWindow = infoWindow;
            });
          });
        });
    }
  </script>

  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCZPRJzf-rbyrdjWjmJYWYpb74dnfLjkHw&callback=initMap">
  </script>
</body>
</html>

