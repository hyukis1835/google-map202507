<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>世界遺産マップ（CSV版）</title>
  <style>
    #map {
      height: 100vh;
      width: 100%;
    }
    body {
      margin: 0;
    }
    .infowindow-content {
      font-weight: bold;
      font-size: 14px;
      padding: 4px 6px;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    let map;
    let openInfoWindow = null;

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 41.9028, lng: 12.4964 }, // ローマ
        zoom: 3,
        gestureHandling: 'greedy',
        scrollwheel: true,
      });

      // モバイル向け：Notionスマホでの2本指操作対応
      map.setOptions({ gestureHandling: "cooperative" });

      fetch('places.csv')
        .then(response => response.text())
        .then(text => {
          const lines = text.trim().split('\n');
          lines.forEach((line, index) => {
            const [name, lat, lng] = line.split(',');
            if (!name || !lat || !lng) return;

            const position = { lat: parseFloat(lat), lng: parseFloat(lng) };
            const marker = new google.maps.Marker({
              position,
              map,
              title: name,
              label: {
                text: (index + 1).toString(),
                color: "white",
                fontWeight: "bold",
                fontSize: "14px"
              },
              icon: {
                path: google.maps.SymbolPath.CIRCLE,
                scale: 12,
                fillColor: "orange",
                fillOpacity: 1,
                strokeWeight: 2,
                strokeColor: "white"
              }
            });

            const infoWindow = new google.maps.InfoWindow({
              content: `<div class="infowindow-content">${name}</div>`,
              disableAutoPan: false,
            });

            marker.addListener("click", () => {
              if (openInfoWindow) {
                openInfoWindow.close();
                if (openInfoWindow === infoWindow) {
                  openInfoWindow = null;
                  return;
                }
              }
              infoWindow.open(map, marker);
              openInfoWindow = infoWindow;
            });
          });
        });
    }
  </script>

  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCZPRJzf-rbyrdjWjmJYWYpb74dnfLjkHw&callback=initMap">
  </script>
</body>
</html>
